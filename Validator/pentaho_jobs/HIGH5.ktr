<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>high_value_leads_consolidation</name>
    <description>Joins leads, people, and organizations data to identify and enrich high-value leads with contact and company information.</description>
    <extended_description/>
    <trans_version>1</trans_version>
    <trans_type>Normal</trans_type>
    <directory>/</directory>
    <parameters>
      <parameter>
        <name>LEADS_INPUT</name>
        <default_value>leads.csv</default_value>
        <description>Path to the leads.csv file.</description>
      </parameter>
      <parameter>
        <name>PEOPLE_INPUT</name>
        <default_value>people.csv</default_value>
        <description>Path to the people.csv file.</description>
      </parameter>
      <parameter>
        <name>ORGS_INPUT</name>
        <default_value>organizations.csv</default_value>
        <description>Path to the organizations.csv file.</description>
      </parameter>
      <parameter>
        <name>OUTPUT_CSV</name>
        <default_value>consolidated_high_value_leads</default_value>
        <description>Base name for the output CSV file.</description>
      </parameter>
    </parameters>
  </info>
  <notepads>
    <notepad>
      <note>This transformation links leads, people, and organizations records. It sorts the data, performs two merge joins, and then filters for leads that are 'Closed Won' with a source of 'Referral' to identify the most valuable prospects.</note>
      <xloc>100</xloc>
      <yloc>50</yloc>
      <width>849</width>
      <heigth>50</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>100</fontcolorred>
      <fontcolorgreen>100</fontcolorgreen>
      <fontcolorblue>100</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
    </notepad>
  </notepads>
  <step>
    <name>Read Leads</name>
    <type>TextFileInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator>,</separator>
    <enclosure>"</enclosure>
    <header>Y</header>
    <file>
      <name>${LEADS_INPUT}</name>
      <filemask/>
      <exclude_filemask/>
      <file_required>Y</file_required>
      <include_subfolders>N</include_subfolders>
    </file>
    <fields>
      <field><name>Index</name><type>Integer</type><format>#</format><currency/><decimal>.</decimal><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type><repeat>N</repeat></field>
      <field><name>Account Id</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
      <field><name>Lead Owner</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
      <field><name>First Name</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
      <field><name>Last Name</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
      <field><name>Company</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
      <field><name>Source</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
      <field><name>Deal Stage</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
    </fields>
  </step>
  <step>
    <name>Read People</name>
    <type>TextFileInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator>,</separator>
    <enclosure>"</enclosure>
    <header>Y</header>
    <file>
      <name>${PEOPLE_INPUT}</name>
      <filemask/>
      <exclude_filemask/>
      <file_required>Y</file_required>
      <include_subfolders>N</include_subfolders>
    </file>
    <fields>
      <field><name>Index</name><type>Integer</type><format>#</format><currency/><decimal>.</decimal><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type><repeat>N</repeat></field>
      <field><name>User Id</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
      <field><name>First Name</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
      <field><name>Last Name</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
      <field><name>Email</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
      <field><name>Phone</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
      <field><name>Job Title</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
    </fields>
  </step>
  <step>
    <name>Read Organizations</name>
    <type>TextFileInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator>,</separator>
    <enclosure>"</enclosure>
    <header>Y</header>
    <file>
      <name>${ORGS_INPUT}</name>
      <filemask/>
      <exclude_filemask/>
      <file_required>Y</file_required>
      <include_subfolders>N</include_subfolders>
    </file>
    <fields>
      <field><name>Index</name><type>Integer</type><format>#</format><currency/><decimal>.</decimal><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type><repeat>N</repeat></field>
      <field><name>Organization Id</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
      <field><name>Name</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
      <field><name>Website</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
      <field><name>Country</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
      <field><name>Industry</name><type>String</type><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>both</trim_type><repeat>N</repeat></field>
    </fields>
  </step>
  <step>
    <name>Sort Leads</name>
    <type>SortRows</type>
    <description>Sorts leads by Company for the first merge join.</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>out</prefix>
    <sort_size>1000000</sort_size>
    <free_memory_limit>25</free_memory_limit>
    <fast_sort>N</fast_sort>
    <compress>N</compress>
    <fields>
      <field><name>Company</name><ascending>Y</ascending><case_sensitive>N</case_sensitive></field>
    </fields>
  </step>
  <step>
    <name>Sort People</name>
    <type>SortRows</type>
    <description>Sorts people by First Name and Last Name to be joined with leads.</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>out</prefix>
    <sort_size>1000000</sort_size>
    <free_memory_limit>25</free_memory_limit>
    <fast_sort>N</fast_sort>
    <compress>N</compress>
    <fields>
      <field><name>First Name</name><ascending>Y</ascending><case_sensitive>N</case_sensitive></field>
      <field><name>Last Name</name><ascending>Y</ascending><case_sensitive>N</case_sensitive></field>
    </fields>
  </step>
  <step>
    <name>Sort Organizations</name>
    <type>SortRows</type>
    <description>Sorts organizations by Name for the second merge join.</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>out</prefix>
    <sort_size>1000000</sort_size>
    <free_memory_limit>25</free_memory_limit>
    <fast_sort>N</fast_sort>
    <compress>N</compress>
    <fields>
      <field><name>Name</name><ascending>Y</ascending><case_sensitive>N</case_sensitive></field>
    </fields>
  </step>
  <step>
    <name>Merge Leads and People</name>
    <type>MergeJoin</type>
    <description>Joins leads and people data based on first and last name to enrich lead records with full contact information.</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <join_type>INNER</join_type>
    <step1>Sort Leads</step1>
    <step2>Sort People</step2>
    <keys_1>
      <key><name>First Name</name></key>
      <key><name>Last Name</name></key>
    </keys_1>
    <keys_2>
      <key><name>First Name</name></key>
      <key><name>Last Name</name></key>
    </keys_2>
  </step>
  <step>
    <name>Merge with Organizations</name>
    <type>MergeJoin</type>
    <description>Joins the enriched leads data with organizations data on the company name to get additional firmographic data.</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <join_type>INNER</join_type>
    <step1>Merge Leads and People</step1>
    <step2>Sort Organizations</step2>
    <keys_1>
      <key><name>Company</name></key>
    </keys_1>
    <keys_2>
      <key><name>Name</name></key>
    </keys_2>
  </step>
  <step>
    <name>Filter High-Value Leads</name>
    <type>FilterRows</type>
    <description>Filters the combined data to only include leads that have a 'Closed Won' deal stage and a 'Referral' source.</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compare>
      <condition>
        <negated>N</negated>
        <conditions>
          <condition>
            <negated>N</negated>
            <leftvalue>Deal Stage</leftvalue>
            <function>=</function>
            <rightvalue>Closed Won</rightvalue>
          </condition>
          <condition>
            <negated>N</negated>
            <operator>AND</operator>
            <leftvalue>Source</leftvalue>
            <function>=</function>
            <rightvalue>Referral</rightvalue>
          </condition>
        </conditions>
      </condition>
    </compare>
  </step>
  <step>
    <name>Select Final Fields</name>
    <type>SelectValues</type>
    <description>Selects a curated list of fields for the final output.</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <field><name>First Name</name></field>
      <field><name>Last Name</name></field>
      <field><name>Email</name></field>
      <field><name>Phone</name></field>
      <field><name>Company</name></field>
      <field><name>Industry</name></field>
      <field><name>Country</name></field>
      <field><name>Deal Stage</name></field>
    </fields>
  </step>
  <step>
    <name>Write High-Value Leads</name>
    <type>TextFileOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator>,</separator>
    <enclosure>"</enclosure>
    <force_ending_line>N</force_ending_line>
    <header>Y</header>
    <file>
      <name>${OUTPUT_CSV}</name>
      <extension>csv</extension>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <create_parent_folder>Y</create_parent_folder>
      <do_not_create_file_folder>N</do_not_create_file_folder>
      <is_command>N</is_command>
    </file>
    <fields/>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <cluster_schema>
    <name>cluster_schema_name</name>
    <dynamic>N</dynamic>
    <steps/>
  </cluster_schema>
  <partitioning_schemas>
  </partitioning_schemas>
  <partition-schema-name>partitions</partition-schema-name>
  <order>
    <hop>
      <from>Read Leads</from>
      <to>Sort Leads</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Read People</from>
      <to>Sort People</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Sort Leads</from>
      <to>Merge Leads and People</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Sort People</from>
      <to>Merge Leads and People</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Merge Leads and People</from>
      <to>Merge with Organizations</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Read Organizations</from>
      <to>Sort Organizations</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Sort Organizations</from>
      <to>Merge with Organizations</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Merge with Organizations</from>
      <to>Filter High-Value Leads</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filter High-Value Leads</from>
      <to>Select Final Fields</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select Final Fields</from>
      <to>Write High-Value Leads</to>
      <enabled>Y</enabled>
    </hop>
  </order>
</transformation>